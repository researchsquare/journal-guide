# --- put this at http level (before server blocks) ---
map $cookie_localizationRedirect $redirect_host {
    default "";
    ~^(journal-guide\.local\.sqr\.io|journal-guide\.staging\.sqr\.io|journal-guide\.dev\.sqr\.io|journal-guide\.com)$ $cookie_localizationRedirect;
}

# --- server block ---
server {
    server_name journal-guide.com ~^.*-journal-guide\..*$;
    root /site/public;

    # Next.js static fallback
    index index.html index.htm;

    # env-like variables used by includes/templates
    set $company_env journal-guide;
    set $localization_env journal-guide-row;

    client_max_body_size 200m;

    include inc/secure.conf;
    include inc/redirects.journal-guide.conf;
    include inc/redirects.conf-@APPLICATION_ENV@;  # make sure this placeholder is replaced at build time
    include inc/compliance.conf;

    location / {
        # safe redirect: if $redirect_host is non-empty, return 302
        if ($redirect_host != "") {
            return 302 https://$redirect_host$uri;
        }

        # serve pre-built SPA file for journal-guide
        try_files $uri /dist/journal-guide/index.html =404;
    }
}